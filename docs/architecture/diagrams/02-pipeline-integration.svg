<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 750" font-family="'Inter','Segoe UI',system-ui,sans-serif">
  <defs>
    <linearGradient id="bgGrad2" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#0f172a"/>
      <stop offset="100%" style="stop-color:#1e293b"/>
    </linearGradient>
    <marker id="arrowCyan" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#22d3ee"/>
    </marker>
    <marker id="arrowAmber" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#fbbf24"/>
    </marker>
    <marker id="arrowEmerald" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#34d399"/>
    </marker>
    <marker id="arrowViolet" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#a78bfa"/>
    </marker>
    <filter id="shadow2">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.3"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="960" height="750" fill="url(#bgGrad2)" rx="12"/>

  <!-- Title -->
  <text x="480" y="38" fill="#f8fafc" font-size="20" font-weight="700" text-anchor="middle">Feature-Pilot パイプライン（Platform 制約統合）</text>
  <text x="480" y="58" fill="#94a3b8" font-size="12" text-anchor="middle">NEW_FEATURE ワークフロー - Step 1 〜 Step 2</text>

  <!-- Step 0: Turbo Mode -->
  <rect x="60" y="80" width="200" height="56" rx="10" fill="#1e293b" stroke="#64748b" stroke-width="1.5" filter="url(#shadow2)"/>
  <text x="90" y="102" fill="#94a3b8" font-size="10" font-weight="700">Step 0</text>
  <text x="90" y="118" fill="#e2e8f0" font-size="11">Turbo Mode コンテキスト</text>
  <text x="90" y="130" fill="#64748b" font-size="9">並列コードベーススキャン</text>
  <path d="M260 108 L310 108" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrowCyan)"/>

  <!-- Step 1: Feature Architect -->
  <rect x="320" y="80" width="260" height="56" rx="10" fill="#1e293b" stroke="#22d3ee" stroke-width="1.5" filter="url(#shadow2)"/>
  <circle cx="340" cy="108" r="8" fill="#22d3ee" fill-opacity="0.2" stroke="#22d3ee" stroke-width="1"/>
  <text x="340" y="112" fill="#22d3ee" font-size="8" font-weight="700" text-anchor="middle">1</text>
  <text x="358" y="102" fill="#22d3ee" font-size="10" font-weight="700">Step 1: feature-architect</text>
  <text x="358" y="118" fill="#e2e8f0" font-size="11">BRIEF.md + CONTEXT.json</text>
  <text x="358" y="130" fill="#67e8f9" font-size="9">CONTEXT.json SSOT 生成</text>

  <!-- Arrow down from Step 1 -->
  <path d="M450 136 L450 170" stroke="#22d3ee" stroke-width="2" marker-end="url(#arrowCyan)"/>

  <!-- ============================================ -->
  <!-- Step 1.5A: Platform Constraints Load (NEW!) -->
  <!-- ============================================ -->
  <rect x="280" y="178" width="340" height="130" rx="10" fill="#312e81" fill-opacity="0.5" stroke="#a78bfa" stroke-width="2" filter="url(#shadow2)"/>
  <rect x="280" y="178" width="340" height="28" rx="10" fill="#7c3aed" fill-opacity="0.3"/>
  <text x="310" y="196" fill="#e9d5ff" font-size="11" font-weight="700">Step 1.5A: Platform 制約ロード</text>
  <text x="600" y="196" fill="#c084fc" font-size="9" text-anchor="end">自動</text>

  <!-- constraints.json reference -->
  <rect x="300" y="216" width="300" height="24" rx="4" fill="#1e1b4b" fill-opacity="0.8" stroke="#6366f1" stroke-width="0.5"/>
  <text x="310" y="232" fill="#a5b4fc" font-size="10">docs/architecture/constraints.json</text>
  <circle cx="590" cy="228" r="6" fill="#22c55e" fill-opacity="0.2" stroke="#22c55e" stroke-width="1"/>
  <text x="590" y="231" fill="#22c55e" font-size="7" text-anchor="middle">?</text>

  <!-- Decision diamond shape using path -->
  <text x="310" y="260" fill="#c4b5fd" font-size="10">存在?</text>
  <text x="380" y="260" fill="#4ade80" font-size="10" font-weight="600">YES</text>
  <text x="310" y="278" fill="#94a3b8" font-size="9">JSON解析、must/must_not、tech_stack 抽出</text>
  <text x="430" y="260" fill="#94a3b8" font-size="10">|</text>
  <text x="450" y="260" fill="#f87171" font-size="10" font-weight="600">NO</text>
  <text x="450" y="278" fill="#94a3b8" font-size="9">ハードコード制約にフォールバック</text>

  <text x="300" y="300" fill="#7c3aed" font-size="9" font-style="italic">後方互換: constraints.json の有無に関わらず動作</text>

  <!-- Arrow down -->
  <path d="M450 308 L450 330" stroke="#a78bfa" stroke-width="2" marker-end="url(#arrowViolet)"/>

  <!-- ============================================ -->
  <!-- Step 1.5B: Discovery & Architecture -->
  <!-- ============================================ -->
  <rect x="80" y="338" width="800" height="200" rx="10" fill="#0c4a6e" fill-opacity="0.3" stroke="#0ea5e9" stroke-width="1.5" filter="url(#shadow2)"/>
  <rect x="80" y="338" width="800" height="28" rx="10" fill="#0ea5e9" fill-opacity="0.2"/>
  <text x="110" y="357" fill="#7dd3fc" font-size="11" font-weight="700">Step 1.5B: Discovery &amp; Architecture（Tier M+ のみ）</text>
  <text x="860" y="357" fill="#38bdf8" font-size="9" text-anchor="end">条件付き</text>

  <!-- Tier S skip -->
  <rect x="100" y="380" width="140" height="54" rx="6" fill="#1e293b" stroke="#64748b" stroke-width="1"/>
  <text x="170" y="400" fill="#94a3b8" font-size="10" font-weight="600" text-anchor="middle">Tier S</text>
  <text x="170" y="416" fill="#fbbf24" font-size="11" font-weight="700" text-anchor="middle">全スキップ</text>
  <text x="170" y="430" fill="#64748b" font-size="8" text-anchor="middle">Step 2 へ進む</text>

  <!-- Tier M -->
  <rect x="260" y="380" width="170" height="54" rx="6" fill="#1e293b" stroke="#22d3ee" stroke-width="1"/>
  <text x="345" y="400" fill="#22d3ee" font-size="10" font-weight="600" text-anchor="middle">Tier M</text>
  <text x="345" y="416" fill="#e2e8f0" font-size="10" text-anchor="middle">domain-modeler</text>
  <text x="345" y="430" fill="#67e8f9" font-size="8" text-anchor="middle">--lightweight</text>

  <!-- Tier L -->
  <rect x="450" y="380" width="190" height="54" rx="6" fill="#1e293b" stroke="#a78bfa" stroke-width="1"/>
  <text x="545" y="400" fill="#a78bfa" font-size="10" font-weight="600" text-anchor="middle">Tier L</text>
  <text x="545" y="416" fill="#e2e8f0" font-size="10" text-anchor="middle">domain-modeler</text>
  <text x="545" y="430" fill="#c4b5fd" font-size="10" text-anchor="middle">+ architecture-selector</text>

  <!-- Tier XL -->
  <rect x="660" y="380" width="200" height="54" rx="6" fill="#1e293b" stroke="#f472b6" stroke-width="1"/>
  <text x="760" y="400" fill="#f472b6" font-size="10" font-weight="600" text-anchor="middle">Tier XL</text>
  <text x="760" y="416" fill="#e2e8f0" font-size="10" text-anchor="middle">domain + architecture</text>
  <text x="760" y="430" fill="#fbcfe8" font-size="10" text-anchor="middle">+ system-designer</text>

  <!-- constraints.json feed arrow -->
  <rect x="100" y="450" width="760" height="36" rx="6" fill="#312e81" fill-opacity="0.3" stroke="#7c3aed" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="480" y="472" fill="#c4b5fd" font-size="10" text-anchor="middle">constraints.json は architecture-selector が自動ロード（Step 0.5 内部処理）</text>

  <!-- Discovery Gate -->
  <rect x="310" y="500" width="260" height="30" rx="6" fill="#065f46" fill-opacity="0.4" stroke="#34d399" stroke-width="1"/>
  <text x="440" y="520" fill="#6ee7b7" font-size="11" font-weight="600" text-anchor="middle">Discovery ゲート: Go / 条件付き / No-Go</text>

  <!-- Arrow down -->
  <path d="M440 530 L440 560" stroke="#34d399" stroke-width="2" marker-end="url(#arrowEmerald)"/>

  <!-- Step 2 -->
  <rect x="310" y="568" width="260" height="56" rx="10" fill="#1e293b" stroke="#fbbf24" stroke-width="1.5" filter="url(#shadow2)"/>
  <circle cx="330" cy="596" r="8" fill="#fbbf24" fill-opacity="0.2" stroke="#fbbf24" stroke-width="1"/>
  <text x="330" y="600" fill="#fbbf24" font-size="8" font-weight="700" text-anchor="middle">2</text>
  <text x="348" y="590" fill="#fbbf24" font-size="10" font-weight="700">Step 2: feature-spec-generator</text>
  <text x="348" y="606" fill="#e2e8f0" font-size="11">SPEC.md + screens/*.md</text>
  <text x="348" y="618" fill="#fde68a" font-size="9">Step 1 の CONTEXT.json が必要</text>

  <!-- Arrow down -->
  <path d="M440 624 L440 650" stroke="#fbbf24" stroke-width="2" marker-end="url(#arrowAmber)"/>

  <!-- Continue indicator -->
  <rect x="370" y="658" width="140" height="28" rx="14" fill="#334155" stroke="#64748b" stroke-width="1"/>
  <text x="440" y="677" fill="#94a3b8" font-size="10" text-anchor="middle">Step 3〜7 へ続く...</text>

  <!-- Legend -->
  <rect x="650" y="80" width="270" height="76" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1"/>
  <text x="670" y="100" fill="#94a3b8" font-size="10" font-weight="600">凡例</text>
  <rect x="670" y="108" width="10" height="10" rx="2" fill="#a78bfa" fill-opacity="0.3" stroke="#a78bfa" stroke-width="1"/>
  <text x="688" y="118" fill="#c4b5fd" font-size="9">新規: Platform 制約統合</text>
  <rect x="670" y="124" width="10" height="10" rx="2" fill="#0ea5e9" fill-opacity="0.3" stroke="#0ea5e9" stroke-width="1"/>
  <text x="688" y="134" fill="#7dd3fc" font-size="9">既存: Discovery &amp; Architecture</text>
  <rect x="670" y="140" width="10" height="10" rx="2" fill="#334155" stroke="#64748b" stroke-width="1"/>
  <text x="688" y="150" fill="#94a3b8" font-size="9">標準パイプラインステップ</text>

  <!-- Footer -->
  <line x1="40" y1="720" x2="920" y2="720" stroke="#334155" stroke-width="0.5"/>
  <text x="480" y="738" fill="#64748b" font-size="9" text-anchor="middle">Hackathon Project - Feature-Pilot パイプライン統合 | NEW_FEATURE ワークフロー</text>
</svg>
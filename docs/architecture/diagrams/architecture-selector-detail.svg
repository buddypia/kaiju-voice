<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 820" font-family="'Segoe UI', 'Helvetica Neue', Arial, sans-serif">
  <defs>
    <linearGradient id="bgGrad3" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#0b1120"/>
      <stop offset="100%" stop-color="#0f172a"/>
    </linearGradient>
    <linearGradient id="amberGrad3" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#f59e0b"/>
      <stop offset="100%" stop-color="#d97706"/>
    </linearGradient>
    <linearGradient id="blueGrad3" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#3b82f6"/>
      <stop offset="100%" stop-color="#2563eb"/>
    </linearGradient>
    <filter id="glow3">
      <feGaussianBlur stdDeviation="4" result="blur"/>
      <feMerge>
        <feMergeNode in="blur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <marker id="arr3" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#f59e0b" stroke-width="1.2"/>
    </marker>
    <marker id="arrBlue3" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#3b82f6" stroke-width="1.2"/>
    </marker>
    <marker id="arrGray3" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#64748b" stroke-width="1.2"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1100" height="820" fill="url(#bgGrad3)"/>

  <!-- Title -->
  <text x="550" y="38" text-anchor="middle" fill="#e2e8f0" font-size="20" font-weight="600">
    architecture-selector 内部プロセス詳細
  </text>
  <text x="550" y="58" text-anchor="middle" fill="#fbbf24" font-size="12">
    discovery_full ステップ内 — 入力・プロセス・出力の全体像
  </text>
  <line x1="200" y1="70" x2="900" y2="70" stroke="#f59e0b" stroke-width="1" opacity="0.3"/>

  <!-- ============ Input Section ============ -->
  <text x="60" y="105" fill="#94a3b8" font-size="12" font-weight="600" letter-spacing="2">入力ドキュメント</text>

  <!-- BRIEF.md -->
  <rect x="60" y="118" width="180" height="65" rx="8" fill="#1e293b" stroke="#3b82f6" stroke-width="1.2"/>
  <text x="90" y="140" fill="#93c5fd" font-size="10" font-weight="600">BRIEF.md</text>
  <text x="90" y="155" fill="#64748b" font-size="8">ユーザーストーリー</text>
  <text x="90" y="167" fill="#64748b" font-size="8">Why / Scope / 制約</text>
  <text x="220" y="140" text-anchor="end" fill="#475569" font-size="8">by architect</text>

  <!-- DOMAIN-MODEL.md -->
  <rect x="270" y="118" width="200" height="65" rx="8" fill="#1e293b" stroke="#8b5cf6" stroke-width="1.2"/>
  <text x="300" y="140" fill="#c4b5fd" font-size="10" font-weight="600">DOMAIN-MODEL.md</text>
  <text x="300" y="155" fill="#64748b" font-size="8">Bounded Context</text>
  <text x="300" y="167" fill="#64748b" font-size="8">Aggregate / Entity / Event</text>
  <text x="450" y="140" text-anchor="end" fill="#7c3aed" font-size="8">by domain-modeler</text>

  <!-- CONTEXT.json -->
  <rect x="500" y="118" width="180" height="65" rx="8" fill="#1e293b" stroke="#3b82f6" stroke-width="1.2"/>
  <text x="530" y="140" fill="#93c5fd" font-size="10" font-weight="600">CONTEXT.json</text>
  <text x="530" y="155" fill="#64748b" font-size="8">機能ID / 状態</text>
  <text x="530" y="167" fill="#64748b" font-size="8">Hard Constraints</text>

  <!-- constraints.json -->
  <rect x="710" y="118" width="180" height="65" rx="8" fill="#1e293b" stroke="#475569" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="740" y="140" fill="#94a3b8" font-size="10" font-weight="600">constraints.json</text>
  <text x="740" y="155" fill="#64748b" font-size="8">Platform制約</text>
  <text x="740" y="167" fill="#64748b" font-size="8">(存在時は自動ロード)</text>
  <text x="870" y="140" text-anchor="end" fill="#475569" font-size="8">optional</text>

  <!-- Arrows from inputs -->
  <line x1="150" y1="183" x2="150" y2="220" stroke="#64748b" stroke-width="1" marker-end="url(#arrGray3)"/>
  <line x1="370" y1="183" x2="370" y2="220" stroke="#64748b" stroke-width="1" marker-end="url(#arrGray3)"/>
  <line x1="590" y1="183" x2="590" y2="220" stroke="#64748b" stroke-width="1" marker-end="url(#arrGray3)"/>
  <line x1="800" y1="183" x2="800" y2="220" stroke="#64748b" stroke-width="1" stroke-dasharray="4,3" marker-end="url(#arrGray3)"/>

  <!-- ============ Main Process ============ -->
  <rect x="40" y="222" width="1020" height="430" rx="14" fill="none" stroke="#f59e0b" stroke-width="2" filter="url(#glow3)"/>
  <rect x="40" y="222" width="1020" height="430" rx="14" fill="#f59e0b" fill-opacity="0.03"/>

  <text x="550" y="250" text-anchor="middle" fill="#fde68a" font-size="16" font-weight="700">architecture-selector</text>
  <text x="550" y="268" text-anchor="middle" fill="#d97706" font-size="10">Model: Opus | ATAM Lite 評価フレームワーク</text>

  <!-- Phase 1: Architecture Drivers -->
  <rect x="80" y="285" width="440" height="150" rx="10" fill="#1e293b" stroke="#f59e0b" stroke-width="1.2"/>
  <text x="100" y="308" fill="#fbbf24" font-size="12" font-weight="600">Phase 1: Architecture Drivers 分析</text>
  <line x1="100" y1="316" x2="500" y2="316" stroke="#f59e0b" stroke-width="0.5" opacity="0.3"/>

  <!-- Driver boxes -->
  <rect x="95" y="325" width="200" height="40" rx="5" fill="#0f172a" stroke="#3b82f6" stroke-width="0.8"/>
  <text x="195" y="342" text-anchor="middle" fill="#93c5fd" font-size="9" font-weight="500">Functional Drivers</text>
  <text x="195" y="356" text-anchor="middle" fill="#475569" font-size="8">データフロー・統合要件</text>

  <rect x="310" y="325" width="200" height="40" rx="5" fill="#0f172a" stroke="#10b981" stroke-width="0.8"/>
  <text x="410" y="342" text-anchor="middle" fill="#6ee7b7" font-size="9" font-weight="500">Quality Attribute Drivers</text>
  <text x="410" y="356" text-anchor="middle" fill="#475569" font-size="8">性能・セキュリティ・信頼性</text>

  <rect x="95" y="375" width="200" height="40" rx="5" fill="#0f172a" stroke="#8b5cf6" stroke-width="0.8"/>
  <text x="195" y="392" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="500">Technical Constraints</text>
  <text x="195" y="406" text-anchor="middle" fill="#475569" font-size="8">Feature-First / React Hooks等</text>

  <rect x="310" y="375" width="200" height="40" rx="5" fill="#0f172a" stroke="#f59e0b" stroke-width="0.8"/>
  <text x="410" y="392" text-anchor="middle" fill="#fbbf24" font-size="9" font-weight="500">Business Constraints</text>
  <text x="410" y="406" text-anchor="middle" fill="#475569" font-size="8">コスト・スケジュール</text>

  <!-- Arrow -->
  <line x1="300" y1="435" x2="300" y2="455" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arr3)"/>

  <!-- Phase 2: Alternatives -->
  <rect x="80" y="458" width="440" height="105" rx="10" fill="#1e293b" stroke="#f59e0b" stroke-width="1.2"/>
  <text x="100" y="480" fill="#fbbf24" font-size="12" font-weight="600">Phase 2: 代替案生成 (最低3案)</text>
  <line x1="100" y1="488" x2="500" y2="488" stroke="#f59e0b" stroke-width="0.5" opacity="0.3"/>

  <rect x="95" y="498" width="126" height="52" rx="6" fill="#10b981" fill-opacity="0.1" stroke="#10b981" stroke-width="1.2"/>
  <text x="158" y="516" text-anchor="middle" fill="#6ee7b7" font-size="10" font-weight="600">Option A</text>
  <text x="158" y="530" text-anchor="middle" fill="#34d399" font-size="8">推奨案</text>
  <text x="158" y="542" text-anchor="middle" fill="#475569" font-size="7">バランス型</text>

  <rect x="237" y="498" width="126" height="52" rx="6" fill="#3b82f6" fill-opacity="0.1" stroke="#3b82f6" stroke-width="1"/>
  <text x="300" y="516" text-anchor="middle" fill="#93c5fd" font-size="10" font-weight="600">Option B</text>
  <text x="300" y="530" text-anchor="middle" fill="#60a5fa" font-size="8">代替案</text>
  <text x="300" y="542" text-anchor="middle" fill="#475569" font-size="7">品質優先型</text>

  <rect x="379" y="498" width="126" height="52" rx="6" fill="#8b5cf6" fill-opacity="0.1" stroke="#8b5cf6" stroke-width="1"/>
  <text x="442" y="516" text-anchor="middle" fill="#c4b5fd" font-size="10" font-weight="600">Option C</text>
  <text x="442" y="530" text-anchor="middle" fill="#a78bfa" font-size="8">最小構成</text>
  <text x="442" y="542" text-anchor="middle" fill="#475569" font-size="7">MVP向け軽量</text>

  <!-- Phase 3: ATAM Lite -->
  <rect x="580" y="285" width="450" height="150" rx="10" fill="#1e293b" stroke="#f59e0b" stroke-width="1.2"/>
  <text x="600" y="308" fill="#fbbf24" font-size="12" font-weight="600">Phase 3: ATAM Lite 評価マトリクス</text>
  <line x1="600" y1="316" x2="1010" y2="316" stroke="#f59e0b" stroke-width="0.5" opacity="0.3"/>

  <!-- Matrix table -->
  <rect x="600" y="325" width="410" height="20" rx="3" fill="#f59e0b" fill-opacity="0.1"/>
  <text x="660" y="339" text-anchor="middle" fill="#d97706" font-size="8">Quality Attr</text>
  <text x="770" y="339" text-anchor="middle" fill="#6ee7b7" font-size="8">Option A</text>
  <text x="860" y="339" text-anchor="middle" fill="#93c5fd" font-size="8">Option B</text>
  <text x="950" y="339" text-anchor="middle" fill="#c4b5fd" font-size="8">Option C</text>

  <text x="660" y="360" text-anchor="middle" fill="#94a3b8" font-size="8">性能</text>
  <text x="770" y="360" text-anchor="middle" fill="#6ee7b7" font-size="9">H</text>
  <text x="860" y="360" text-anchor="middle" fill="#fbbf24" font-size="9">M</text>
  <text x="950" y="360" text-anchor="middle" fill="#ef4444" font-size="9">L</text>

  <text x="660" y="378" text-anchor="middle" fill="#94a3b8" font-size="8">セキュリティ</text>
  <text x="770" y="378" text-anchor="middle" fill="#fbbf24" font-size="9">M</text>
  <text x="860" y="378" text-anchor="middle" fill="#6ee7b7" font-size="9">H</text>
  <text x="950" y="378" text-anchor="middle" fill="#fbbf24" font-size="9">M</text>

  <text x="660" y="396" text-anchor="middle" fill="#94a3b8" font-size="8">保守性</text>
  <text x="770" y="396" text-anchor="middle" fill="#6ee7b7" font-size="9">H</text>
  <text x="860" y="396" text-anchor="middle" fill="#fbbf24" font-size="9">M</text>
  <text x="950" y="396" text-anchor="middle" fill="#6ee7b7" font-size="9">H</text>

  <text x="660" y="414" text-anchor="middle" fill="#94a3b8" font-size="8">テスト容易性</text>
  <text x="770" y="414" text-anchor="middle" fill="#6ee7b7" font-size="9">H</text>
  <text x="860" y="414" text-anchor="middle" fill="#6ee7b7" font-size="9">H</text>
  <text x="950" y="414" text-anchor="middle" fill="#fbbf24" font-size="9">M</text>

  <!-- Note -->
  <text x="605" y="432" fill="#64748b" font-size="7">H=High  M=Medium  L=Low</text>

  <!-- Sensitivity/Tradeoff/Risk -->
  <rect x="600" y="325" width="0" height="0"/>

  <!-- Phase 4: ADR Generation -->
  <rect x="580" y="458" width="450" height="105" rx="10" fill="#1e293b" stroke="#f59e0b" stroke-width="1.2"/>
  <text x="600" y="480" fill="#fbbf24" font-size="12" font-weight="600">Phase 4: ADR 生成 (Nygard形式)</text>
  <line x1="600" y1="488" x2="1010" y2="488" stroke="#f59e0b" stroke-width="0.5" opacity="0.3"/>

  <text x="615" y="508" fill="#94a3b8" font-size="9">Context (決定背景)</text>
  <text x="615" y="522" fill="#94a3b8" font-size="9">Architecture Drivers (分析結果)</text>
  <text x="615" y="536" fill="#94a3b8" font-size="9">Alternatives Considered (3案+)</text>
  <text x="615" y="550" fill="#fbbf24" font-size="9" font-weight="600">Decision (選択理由)</text>

  <text x="830" y="508" fill="#94a3b8" font-size="9">ATAM Lite Evaluation</text>
  <text x="830" y="522" fill="#94a3b8" font-size="9">Consequences (+/-/risk)</text>
  <text x="830" y="536" fill="#94a3b8" font-size="9">Sensitivity / Tradeoff Points</text>
  <text x="830" y="550" fill="#94a3b8" font-size="9">References</text>

  <!-- Arrow between phases -->
  <line x1="520" y1="360" x2="580" y2="360" stroke="#f59e0b" stroke-width="1.2" marker-end="url(#arr3)"/>
  <line x1="805" y1="435" x2="805" y2="458" stroke="#f59e0b" stroke-width="1.2" marker-end="url(#arr3)"/>
  <line x1="520" y1="510" x2="580" y2="510" stroke="#f59e0b" stroke-width="1.2" marker-end="url(#arr3)"/>

  <!-- ============ Output Section ============ -->
  <line x1="550" y1="652" x2="550" y2="680" stroke="#f59e0b" stroke-width="2" marker-end="url(#arr3)"/>

  <text x="60" y="700" fill="#94a3b8" font-size="12" font-weight="600" letter-spacing="2">出力</text>

  <!-- ADR output -->
  <rect x="140" y="688" width="320" height="60" rx="10" fill="#f59e0b" fill-opacity="0.1" stroke="#f59e0b" stroke-width="2"/>
  <text x="300" y="712" text-anchor="middle" fill="#fde68a" font-size="13" font-weight="700">ADR-&lt;id&gt;.md</text>
  <text x="300" y="728" text-anchor="middle" fill="#d97706" font-size="9">docs/features/&lt;id&gt;/ADR-&lt;id&gt;.md</text>
  <text x="300" y="742" text-anchor="middle" fill="#92400e" font-size="8">Architecture Decision Record</text>

  <!-- Arrow to next step -->
  <line x1="460" y1="718" x2="530" y2="718" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrBlue3)"/>

  <!-- Next: system-designer -->
  <rect x="530" y="688" width="240" height="60" rx="10" fill="#8b5cf6" fill-opacity="0.08" stroke="#8b5cf6" stroke-width="1.2"/>
  <text x="650" y="712" text-anchor="middle" fill="#c4b5fd" font-size="11" font-weight="600">system-designer へ</text>
  <text x="650" y="728" text-anchor="middle" fill="#a78bfa" font-size="9">ADR の決定に基づき</text>
  <text x="650" y="742" text-anchor="middle" fill="#7c3aed" font-size="8">C4モデルを具体化</text>

  <!-- Arrow to spec -->
  <line x1="770" y1="718" x2="830" y2="718" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrBlue3)"/>
  <rect x="830" y="688" width="210" height="60" rx="10" fill="#3b82f6" fill-opacity="0.08" stroke="#3b82f6" stroke-width="1.2"/>
  <text x="935" y="712" text-anchor="middle" fill="#93c5fd" font-size="11" font-weight="600">spec-generator へ</text>
  <text x="935" y="728" text-anchor="middle" fill="#60a5fa" font-size="9">ADR + SYSTEM-DESIGN を反映し</text>
  <text x="935" y="742" text-anchor="middle" fill="#475569" font-size="8">SPEC.md を技術契約として生成</text>

  <!-- Timeline indicator -->
  <rect x="60" y="770" width="980" height="36" rx="6" fill="#0f172a" stroke="#1e293b" stroke-width="1"/>
  <text x="80" y="793" fill="#64748b" font-size="10">実行タイミング:</text>
  <text x="205" y="793" fill="#fbbf24" font-size="10" font-weight="600">Step 3 (discovery_full) — architect 後、spec 前</text>
  <text x="620" y="793" fill="#64748b" font-size="10">条件:</text>
  <text x="660" y="793" fill="#fbbf24" font-size="10" font-weight="600">NEW_FEATURE + Tier L/XL のみ</text>
</svg>
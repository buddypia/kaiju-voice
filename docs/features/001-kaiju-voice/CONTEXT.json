{
  "schema_version": 7,
  "feature_id": "001-kaiju-voice",
  "title": "KAIJU VOICE — 声で戦う怪獣バトルゲーム",
  "feature_type": "game",

  "quick_resume": {
    "current_state": "Done",
    "current_task": "",
    "next_actions": [],
    "blockers": [],
    "last_updated_at": "2026-02-21T11:50:00+09:00",
    "last_decision": {
      "summary": "全FR実装完了、ビルド・lint・テスト通過",
      "at": "2026-02-21T11:50:00+09:00"
    },
    "current_rationale": "ハッカソン: デモ50%+インパクト25%が審査基準。声で叫ぶインタラクティブ性が勝因。",
    "active_constraints": [
      "Gemini専用 (@google/genai + @ai-sdk/google)",
      "Next.js 16 / React 19 / Tailwind CSS 4",
      "ダークモード専用",
      "日本語UI"
    ],
    "previous_state": "Implementing",
    "question_count": 3
  },

  "progress": {
    "percentage": 100,
    "fr_total": 7,
    "fr_completed": 7,
    "fr_in_progress": 0,
    "details": {
      "FR-00101": {
        "name": "音声キャプチャ",
        "status": "done",
        "files": [
          "src/features/voice/hooks/useVoiceCapture.ts",
          "src/features/voice/components/VoiceRecorder.tsx"
        ]
      },
      "FR-00102": {
        "name": "音声リアルタイム分析 (Gemini)",
        "status": "done",
        "files": ["src/app/api/voice/analyze/route.ts"]
      },
      "FR-00103": {
        "name": "バトルエンジン (HP・ターン・ダメージ)",
        "status": "done",
        "files": [
          "src/features/battle/hooks/useBattleEngine.ts",
          "src/features/battle/types/battle.ts",
          "src/features/game/hooks/useGameState.ts"
        ]
      },
      "FR-00104": {
        "name": "怪獣ビジュアル生成 (Imagen 3)",
        "status": "done",
        "files": [
          "src/app/api/kaiju/generate/route.ts",
          "src/features/kaiju/hooks/useKaijuGeneration.ts",
          "src/features/kaiju/components/KaijuDisplay.tsx"
        ]
      },
      "FR-00105": {
        "name": "リアルタイムBGM (Lyria)",
        "status": "done",
        "files": ["src/app/api/music/generate/route.ts", "src/features/music/hooks/useBattleBGM.ts"]
      },
      "FR-00106": {
        "name": "バトルUI (HPバー・エフェクト・怪獣表示)",
        "status": "done",
        "files": [
          "src/features/battle/components/HPBar.tsx",
          "src/features/battle/components/DamageEffect.tsx",
          "src/features/battle/components/TurnIndicator.tsx",
          "src/features/battle/components/BattleLog.tsx",
          "src/features/battle/components/BattleArena.tsx",
          "src/features/kaiju/components/KaijuCard.tsx"
        ]
      },
      "FR-00107": {
        "name": "ゲームフロー (タイトル→選択→バトル→リザルト)",
        "status": "done",
        "files": [
          "src/features/game/components/TitleScreen.tsx",
          "src/features/game/components/SelectScreen.tsx",
          "src/features/game/components/BattleScreen.tsx",
          "src/features/game/components/ResultScreen.tsx",
          "src/app/page.tsx"
        ]
      }
    }
  },

  "architecture": {
    "domain_model": null,
    "adr": null,
    "system_design": null,
    "discovery_gate": null,
    "tier_applied": "L"
  },

  "why": "東京ハッカソンで審査員の記憶に残るデモを作る。声で怪獣を操る斬新なインタラクションがGemini Live API / Imagen 3 / Lyria の3つのAPIを最大活用し、デモ映え(50%)とインパクト(25%)で高評価を狙う。",
  "success_criteria": [
    "2人のプレイヤーがマイクに向かって叫び、怪獣がリアルタイムで戦う",
    "音声の強度・創造性・言語がダメージに反映される",
    "怪獣の画像がImagen 3で動的に生成される",
    "戦況に応じてBGMがLyriaでリアルタイム変化する",
    "審査員がデモを見て笑い、記憶に残る"
  ],
  "constraints": [
    "Gemini専用 (@google/genai + @ai-sdk/google)",
    "Next.js 16 / React 19 / Tailwind CSS 4",
    "ローカル2P (1台のPC、交互にマイクに向かって叫ぶ)",
    "ダークモード専用",
    "日本語UI"
  ],

  "artifacts": {
    "brief": null,
    "brief_format_version": null,
    "spec": "docs/features/001-kaiju-voice/SPEC-001-kaiju-voice.md",
    "spec_version": "v1.0",
    "spec_locked_at": "2026-02-21T11:35:00+09:00",
    "spec_validation": {
      "last_run_at": "2026-02-21T11:36:00+09:00",
      "verdict": "Go",
      "blocking_count": 0,
      "warning_count": 0
    },
    "screens": [
      "docs/features/001-kaiju-voice/screens/title.md",
      "docs/features/001-kaiju-voice/screens/select.md",
      "docs/features/001-kaiju-voice/screens/battle.md",
      "docs/features/001-kaiju-voice/screens/result.md"
    ],
    "design_assets": null,
    "index": "docs/features/001-kaiju-voice/index.md"
  },

  "references": {
    "priority_order": ["spec", "screens"],
    "current_focus": {
      "document": "SPEC-001",
      "section": "全体",
      "reason": "全FR実装完了"
    },
    "documents": {
      "spec": {
        "path": "docs/features/001-kaiju-voice/SPEC-001-kaiju-voice.md",
        "sections_to_read": ["0", "1", "2", "3", "4", "5"],
        "focus": [
          "FR-00101",
          "FR-00102",
          "FR-00103",
          "FR-00104",
          "FR-00105",
          "FR-00106",
          "FR-00107"
        ]
      },
      "screens": {
        "paths": [
          "docs/features/001-kaiju-voice/screens/title.md",
          "docs/features/001-kaiju-voice/screens/select.md",
          "docs/features/001-kaiju-voice/screens/battle.md",
          "docs/features/001-kaiju-voice/screens/result.md"
        ],
        "focus": ["全画面実装完了"]
      }
    },
    "related_specs": [],
    "related_code": {
      "types": ["src/features/battle/types/battle.ts"],
      "hooks": [
        "src/features/voice/hooks/useVoiceCapture.ts",
        "src/features/battle/hooks/useBattleEngine.ts",
        "src/features/game/hooks/useGameState.ts",
        "src/features/kaiju/hooks/useKaijuGeneration.ts",
        "src/features/music/hooks/useBattleBGM.ts"
      ],
      "api": [
        "src/app/api/voice/analyze/route.ts",
        "src/app/api/kaiju/generate/route.ts",
        "src/app/api/music/generate/route.ts"
      ],
      "components": [
        "src/features/voice/components/VoiceRecorder.tsx",
        "src/features/battle/components/HPBar.tsx",
        "src/features/battle/components/DamageEffect.tsx",
        "src/features/battle/components/TurnIndicator.tsx",
        "src/features/battle/components/BattleLog.tsx",
        "src/features/battle/components/BattleArena.tsx",
        "src/features/kaiju/components/KaijuCard.tsx",
        "src/features/kaiju/components/KaijuDisplay.tsx",
        "src/features/game/components/TitleScreen.tsx",
        "src/features/game/components/SelectScreen.tsx",
        "src/features/game/components/BattleScreen.tsx",
        "src/features/game/components/ResultScreen.tsx"
      ],
      "pages": ["src/app/page.tsx"],
      "constants": ["src/shared/constants/kaiju-data.ts", "src/shared/constants/messages.ts"],
      "lib": ["src/shared/lib/gemini.ts"],
      "barrels": [
        "src/features/battle/index.ts",
        "src/features/kaiju/index.ts",
        "src/features/voice/index.ts",
        "src/features/music/index.ts",
        "src/features/game/index.ts"
      ],
      "tests": [
        "tests/unit/features/battle/useBattleEngine.test.ts",
        "tests/unit/features/game/useGameState.test.ts"
      ]
    },
    "dependencies": {
      "features": [],
      "packages": ["@google/genai", "zod", "lucide-react"]
    }
  },

  "execution": {
    "lock": {
      "locked": false,
      "locked_by": null,
      "locked_at": null
    },
    "active_branch": null,
    "rollback_point": null
  },

  "decisions": [
    {
      "at": "2026-02-21T11:25:00+09:00",
      "summary": "ローカル2P方式を選択（WebSocket不要でシンプル）",
      "rationale": "ハッカソンの時間制約内でデモ映えする形式を優先"
    },
    {
      "at": "2026-02-21T11:30:00+09:00",
      "summary": "useReducer で状態管理（XState 不使用）",
      "rationale": "ゲームフローが4フェーズの線形遷移で単純なため、useReducer で十分。XState のオーバーヘッド不要"
    },
    {
      "at": "2026-02-21T11:35:00+09:00",
      "summary": "シングルページ条件レンダリング方式を採用",
      "rationale": "ゲーム状態を単一コンポーネントツリーで管理し、ルーティング不要にすることでシンプル化"
    },
    {
      "at": "2026-02-21T11:38:00+09:00",
      "summary": "3 Agent 並列実装（API/UI/Pages）",
      "rationale": "ファイル所有権を分離し、3つの独立した作業を並列実行して実装時間を1/3に短縮"
    },
    {
      "at": "2026-02-21T11:40:00+09:00",
      "summary": "Gemini v1alpha を Lyria RealTime に使用",
      "rationale": "Lyria WebSocket は v1alpha API バージョンが必要。標準 Gemini とは別クライアントインスタンスで管理"
    }
  ],

  "open_questions": [],

  "history": [
    {
      "at": "2026-02-21T11:20:00+09:00",
      "from_state": "Idle",
      "to_state": "Briefing",
      "triggered_by": "feature-pilot",
      "note": "KAIJU VOICE プロジェクト開始"
    },
    {
      "at": "2026-02-21T11:30:00+09:00",
      "from_state": "Briefing",
      "to_state": "SpecDrafting",
      "triggered_by": "feature-pilot",
      "note": "要件分析完了、SPEC作成開始"
    },
    {
      "at": "2026-02-21T11:34:00+09:00",
      "from_state": "SpecDrafting",
      "to_state": "UiApproval",
      "triggered_by": "feature-spec-generator",
      "note": "SPEC-001-kaiju-voice.md 作成完了"
    },
    {
      "at": "2026-02-21T11:35:00+09:00",
      "from_state": "UiApproval",
      "to_state": "Implementing",
      "triggered_by": "ui-approval-gate + readiness-gate",
      "note": "UI承認 + Readiness Gate Go 判定"
    },
    {
      "at": "2026-02-21T11:38:00+09:00",
      "from_state": "Implementing",
      "to_state": "Implementing",
      "triggered_by": "feature-pilot",
      "note": "Foundation 実装完了、3 Agent 並列実装開始"
    },
    {
      "at": "2026-02-21T11:45:00+09:00",
      "from_state": "Implementing",
      "to_state": "Reviewing",
      "triggered_by": "feature-pilot",
      "note": "3 Agent 全完了。ビルド成功、lint 0エラー、16テスト通過"
    },
    {
      "at": "2026-02-21T11:50:00+09:00",
      "from_state": "Reviewing",
      "to_state": "Done",
      "triggered_by": "feature-pilot",
      "note": "全FR実装完了、品質検証通過、CONTEXT.json 最終更新"
    }
  ],

  "autonomy_control": {
    "max_questions_per_session": 7,
    "auto_stop_conditions": ["7問質問上限到達", "BLOCKING パターン発見"],
    "current_autonomy_level": "supervised",
    "tier": 1,
    "claude_md_checked": true,
    "claude_md_version": "2026-02-21"
  },

  "esp_execution_log": {
    "schema_version": 1,
    "summary": {
      "total_esp_calls": 1,
      "preflight_completed": 1,
      "postflight_completed": 1,
      "violations": 0,
      "compliance_rate": 1.0
    },
    "executions": [],
    "violations_history": []
  },

  "traceability": {
    "user_story_to_fr": [
      {
        "user_story": "AS A ハッカソン参加者 I WANT TO 声で怪獣を操って対戦する SO THAT 審査員が爆笑し記憶に残るデモができる",
        "frs": ["FR-00101", "FR-00102", "FR-00103", "FR-00104", "FR-00105", "FR-00106", "FR-00107"]
      }
    ],
    "bdd_to_fr": [],
    "unmapped_user_stories": [],
    "unmapped_bdd_scenarios": [],
    "validated_at": "2026-02-21T11:50:00+09:00"
  },

  "priority": {
    "version": "3.0",
    "schema": "rice-v2",
    "last_updated": "2026-02-21T11:50:00+09:00",
    "phase": "mvp",
    "rice_inputs": {
      "reach": { "score": 10, "evidence": {}, "rationale": "ハッカソン審査員全員" },
      "impact": { "score": 3, "evidence": {}, "rationale": "デモ映え最大" },
      "confidence": { "score": 0.8, "factors": {} },
      "effort": { "score": 1, "unit": "hackathon-day", "evidence": {}, "rationale": "1日で完成" }
    },
    "competitive_adjustment": {
      "adjustment": 1.0,
      "has_data": false,
      "evidence": {},
      "rationale": ""
    },
    "calculated": {
      "rice_score": 24,
      "adjusted_score": 24,
      "competitive_adjustment": 1.0,
      "manual_override_applied": 1.0,
      "formula": "(10 × 3 × 0.8) / 1",
      "component_breakdown": {}
    },
    "data_sources_read": [],
    "manual_override": { "value": 1.0, "reason": null },
    "ai_rationale": "ハッカソンMVP",
    "history": []
  },

  "completion_contract": {
    "version": "1.0",
    "work_type": "NEW_FEATURE",
    "source": "hackathon-requirements",
    "last_verified_at": "2026-02-21T11:50:00+09:00",
    "verdict": "passed",
    "items": [
      {
        "id": "CC-001",
        "description": "全7 FR実装完了",
        "type": "machine",
        "status": "passed",
        "evidence": "src/ 配下に全FR対応ファイルが存在"
      },
      {
        "id": "CC-002",
        "description": "ビルド成功 (next build)",
        "type": "machine",
        "status": "passed",
        "evidence": "Next.js 16.1.6 Turbopack ビルド成功"
      },
      {
        "id": "CC-003",
        "description": "lint エラー 0件",
        "type": "machine",
        "status": "passed",
        "evidence": "eslint: 0 errors, 1 warning (img element — 妥当)"
      },
      {
        "id": "CC-004",
        "description": "テスト全通過",
        "type": "machine",
        "status": "passed",
        "evidence": "vitest: 16 passed (2 suites, 725ms)"
      },
      {
        "id": "CC-005",
        "description": "API Routes 3つ動作",
        "type": "machine",
        "status": "passed",
        "evidence": "next build で /api/voice/analyze, /api/kaiju/generate, /api/music/generate がDynamic route として認識"
      }
    ],
    "summary": {
      "total": 5,
      "passed": 5,
      "failed": 0,
      "skipped": 0,
      "pass_rate": 1.0
    }
  },

  "brief_context": {
    "core_goal": "声で戦う怪獣バトルゲームで審査員を圧倒する",
    "user_value": "叫んで怪獣を操る斬新な体験",
    "business_metrics": ["デモ映え", "審査員記憶度"],
    "user_story": "AS A ハッカソン参加者 I WANT TO 声で怪獣を操って対戦する SO THAT 審査員が爆笑し記憶に残るデモができる",
    "priority_label": "P0-MVP"
  }
}

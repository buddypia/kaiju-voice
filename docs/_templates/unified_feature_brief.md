# 機能概要: {NNN}-{feature-name}

> **ステータス**: 草案 | **優先度**: - | **作成日**: {YYYY-MM-DD}
> **コンテキスト**: `docs/features/{NNN}-{feature-name}/CONTEXT.json`

---

## 0. 元のリクエスト (ユーザー原文)

> ユーザーの元のリクエストをそのまま保存します。意図の逆追跡のアンカー役を果たします。

```
{ユーザー原文そのままコピー - 編集/要約禁止}
```

---

## 1. 問題と理由 (Shape Up Pitch)

### 問題 (解決すべき問題)

{現在の状況でどのような問題があるかを1-3文で記述}

### 今なぜ (今やるべき理由)

{なぜ今この機能が必要なのか、遅延した際のリスクは何か}

### 食欲 (投資意向)

| 項目                   | 値                                            |
| ---------------------- | --------------------------------------------- |
| **タイムボックス**     | {スモールバッチ: 1-2日 / ビッグバッチ: 1-2週} |
| **複雑さ**             | {低 / 中 / 高}                                |
| **ユーザー価値**       | {期待されるユーザー価値を1文で}               |
| **ビジネスメトリック** | {測定可能なビジネス指標 - オプション}         |

---

## 2. ユーザーストーリー (JTBDベース)

> **形式**: "When [状況], I want to [行動], So I can [価値]"

|  ID   | When (状況) | I want to (行動) | So I can (価値) |
| :---: | ----------- | ---------------- | --------------- |
| US-01 | {状況}      | {行動}           | {価値}          |
| US-02 | {状況}      | {行動}           | {価値}          |

---

## 3. ユーザージャーニー (ユーザーの旅)

> コアユーザーフローをステップごとに記述します。

| ステップ | ユーザー行動 | システム反応 | 備考 |
| :------: | ------------ | ------------ | ---- |
|    1     | {行動}       | {反応}       |      |
|    2     | {行動}       | {反応}       |      |
|    3     | {行動}       | {反応}       |      |

---

## 4. 受け入れ基準 (BDDベース)

> **形式**: Given/When/Then (ユーザー視点の受け入れ基準)

|  AC   | Given (前提) | When (行動)    | Then (結果) | 観測点     |
| :---: | ------------ | -------------- | ----------- | ---------- |
| AC-01 | {前提条件}   | {ユーザー行動} | {期待結果}  | {確認方法} |
| AC-02 | {前提条件}   | {ユーザー行動} | {期待結果}  | {確認方法} |

---

## 5. スコープの境界 (範囲境界)

### スコープ内 (含む)

- {今回の実装に含まれるもの 1}
- {今回の実装に含まれるもの 2}

### スコープ外 (除外)

- {今回の実装から除外されるもの 1}
- {今回の実装から除外されるもの 2}

### ラビットホール (複雑さの罠)

> Shape Upのラビットホールの概念: 予想以上に複雑になる可能性のある領域を事前に特定

- {潜在的複雑さの罠 1 - なぜ危険で、どう回避するか}
- {潜在的複雑さの罠 2}

### §5.5 エンゲージメントデザイン (ユーザー対面機能のみ - バックエンド専用は "N/A")

> **適用基準**: UIのあるユーザー対面機能のみに適用。バックエンド専用/ロジック専用機能は "N/A - バックエンド専用" と記載。

#### フックモデル (Nir Eyal)

| ステージ                          | 設計                                                 | 例                                           |
| --------------------------------- | ---------------------------------------------------- | -------------------------------------------- |
| **トリガー** (外部/内部)          | {どのようなきっかけでユーザーがこの機能に入るのか？} | プッシュ通知、アプリ内バッジ、習慣           |
| **アクション** (核心行動)         | {ユーザーの最小行動単位は？}                         | タップ1回、スワイプ、音声入力                |
| **バリアブルリワード** (可変報酬) | {毎回異なる報酬があるか？}                           | 新コンテンツ、スコアの変動、AIフィードバック |
| **投資**                          | {ユーザーが何を残すか？}                             | 学習記録、カスタム設定、単語帳               |

#### BJ Fogg MAP (動機 × 能力 × 誘因)

| 要素     | 設計                                             |
| -------- | ------------------------------------------------ |
| **動機** | {ユーザーがなぜこの機能を使おうとしているのか？} |
| **能力** | {最低限の認知コストは？どれだけ簡単か？}         |
| **誘因** | {いつ、どのように行動を促すか？}                 |

#### JTBD 情緒的/社会的な仕事

| ジョブタイプ     | 説明                                                    |
| ---------------- | ------------------------------------------------------- |
| **機能的ジョブ** | {解決したい機能的課題}                                  |
| **情緒的ジョブ** | {使用時に感じたい感情 - 自信、達成感、安心感など}       |
| **社会的ジョブ** | {他人にどう見られたいか - 流暢に見える、努力を示すなど} |

#### Ahaモーメント (核心価値の体験瞬間)

> {ユーザーが「この機能は良い！」と感じる最初の瞬間を具体的に定義}
> 例: "最初のAI対話でリアルタイムで修正を受ける瞬間"

### §5.6 競合ベンチマーク (市場に類似機能が存在する場合のみ - ない場合は "N/A")

> **適用基準**: 市場に類似機能が存在する場合のみ作成。完全に新規機能は "N/A - 市場に類似機能なし" と記載。
> **参照**: `docs/research/`, `docs/analysis/competitor-registry.json`

| 競合    | 類似機能 | 我々の差別化ポイント |
| ------- | -------- | -------------------- |
| {競合A} | {機能名} | {差別点}             |
| {競合B} | {機能名} | {差別点}             |

**主な差別化要素**:

- {核心差別化 1}
- {核心差別化 2}

### §5.7 マネタイズタッチポイント (有料/無料の体験差がある機能のみ - ない場合は "N/A")

> **適用基準**: 無料/有料の体験境界がある機能にのみ作成。
> **ハードペイウォール禁止**: 学習の核心機能にハードペイウォールを適用することはできません (CLAUDE.md参照)

| 項目                       | 設計                                        |
| -------------------------- | ------------------------------------------- |
| **無料体験範囲**           | {無料ユーザーが体験できる範囲}              |
| **有料転換トリガー**       | {どの瞬間にアップグレードを提案するか？}    |
| **ソフトペイウォール方式** | {制限方式 - 回数制限、高度な機能ロックなど} |
| **転換率目標**             | {目標CVR}                                   |
| **離脱防止戦略**           | {ペイウォール拒否時の代替体験}              |

---

## 6. 制約条件 (制約事項)

### ハード制約 (違反禁止)

- [ ] {技術的/ビジネス制約 1}
- [ ] {技術的/ビジネス制約 2}

### ソフト制約 (推奨)

- {推奨事項 1}
- {推奨事項 2}

---

## 7. 完成条件 (Definition of Done)

> AIが「実装完了」と宣言するための測定可能な完了基準。
> 各項目は検証タイプ (machine / ai / human) で分類される。
> CONTEXT.json の completion_contract で追跡される。

### 7.1 機能固有の完了条件

> この機能に固有の完了基準。Base DoD (§7.2) に追加される。

|    ID     | 完了条件               |      検証タイプ      | 観測方法           |
| :-------: | ---------------------- | :------------------: | ------------------ |
| DoD-FS-01 | {機能固有の完了条件 1} | machine / ai / human | {具体的な確認方法} |
| DoD-FS-02 | {機能固有の完了条件 2} | machine / ai / human | {具体的な確認方法} |

### 7.2 Base DoD (共通完了条件)

> 作業タイプに応じて自動適用される共通基準。記載不要（パイプラインが自動注入）。
> 参照: `.claude/pipelines/*.yaml` の `base_dod` セクション

**NEW_FEATURE**: 全FR DoD通過 + make q.check + SPEC §0準拠 + アーキテクチャ準拠 + テスト追加 + ビルド成功 + JSDoc + UI Flow + CONTEXT Done
**MODIFY_FEATURE**: 修正FR DoD通過 + make q.check + 変更履歴更新 + アーキテクチャ準拠 + テスト更新 + ビルド成功 + 非破壊的変更 + CONTEXT Done
**BUG_FIX**: 回帰テスト追加(Red→Green) + make q.check + 根本原因レポート + 最小変更 + テスト通過 + CONTEXT Done

---

## 8. 明確化ログ (明確化記録)

> spec-generatorフェーズ2でユーザーとのQ&Aを記録します。
> feature-architect生成時には空であり、spec-generatorが追加します。

|  #  | 質問                            | 回答 | 影響を受けるセクション | 日付 |
| :-: | ------------------------------- | ---- | :--------------------: | :--: |
|  -  | (spec-generatorフェーズ2で記録) | -    |           -            |  -   |

---

## 9. コンテキストマップ (関連コンテキスト)

> AIがコードベーススキャンで発見した関連ファイル/文書の位置を記録します。

| カテゴリー     | パス/参照                |
| -------------- | ------------------------ |
| **キー仕様**   | {関連SPEC文書のパス}     |
| **関連コード** | {関連ソースコードのパス} |
| **DBテーブル** | {関連テーブル名}         |
| **エッジ関数** | {関連エッジ関数名}       |
| **依存関係**   | {依存機能/パッケージ}    |

---

## ソース (オプション - 候補変換時のみ含む)

> market-intelligence-scannerの候補から変換された場合、原データを記録します。

> **原本候補文書**: [ファイル名](相対パス)
> **ICEスコア**: X.X (I:? / C:? / E:?)
> **Japan-Fit**: ?/10

### 核心差別点

- (Differentiationセクションから抽出)

### 根拠データの要約

- (Evidenceセクションからの核心定量データ)

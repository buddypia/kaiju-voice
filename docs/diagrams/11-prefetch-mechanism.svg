<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 300" font-family="system-ui, sans-serif">
  <defs>
    <marker id="arrow11" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
  </defs>
  <rect width="700" height="300" rx="12" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
  <text x="350" y="28" text-anchor="middle" font-size="16" font-weight="700" fill="#0f172a">プリフェッチ — useRef キャッシュパターン</text>

  <!-- prefetchAIAttack -->
  <rect x="30" y="55" width="200" height="100" rx="10" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
  <text x="130" y="78" text-anchor="middle" font-size="11" font-weight="700" fill="#1e40af">prefetchAIAttack()</text>
  <line x1="40" y1="86" x2="220" y2="86" stroke="#bfdbfe" stroke-width="1"/>
  <text x="130" y="105" text-anchor="middle" font-size="10" fill="#475569">録音開始と同時に</text>
  <text x="130" y="120" text-anchor="middle" font-size="10" fill="#475569">fetch('/api/ai-opponent')</text>
  <text x="130" y="138" text-anchor="middle" font-size="10" fill="#3b82f6">+ AbortController</text>

  <!-- Arrow to useRef -->
  <line x1="235" y1="105" x2="275" y2="105" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow11)"/>
  <text x="255" y="98" font-size="9" fill="#64748b">保存</text>

  <!-- useRef cache -->
  <rect x="280" y="70" width="140" height="70" rx="10" fill="#fdf4ff" stroke="#a855f7" stroke-width="2.5"/>
  <text x="350" y="95" text-anchor="middle" font-size="12" font-weight="700" fill="#6b21a8">useRef</text>
  <text x="350" y="115" text-anchor="middle" font-size="10" fill="#475569">prefetchedRef</text>
  <text x="350" y="130" text-anchor="middle" font-size="9" fill="#94a3b8">再レンダリングなし</text>

  <!-- Arrow to consume -->
  <line x1="425" y1="105" x2="465" y2="105" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow11)"/>
  <text x="445" y="98" font-size="9" fill="#64748b">取得</text>

  <!-- consumePrefetched -->
  <rect x="470" y="55" width="200" height="100" rx="10" fill="#f0fdf4" stroke="#22c55e" stroke-width="2"/>
  <text x="570" y="78" text-anchor="middle" font-size="11" font-weight="700" fill="#166534">consumePrefetched()</text>
  <line x1="480" y1="86" x2="660" y2="86" stroke="#dcfce7" stroke-width="1"/>
  <text x="570" y="105" text-anchor="middle" font-size="10" fill="#475569">AIターン時に呼び出し</text>
  <text x="570" y="120" text-anchor="middle" font-size="10" fill="#475569">結果を取得 + ref を null化</text>
  <text x="570" y="138" text-anchor="middle" font-size="10" fill="#22c55e">1回限りの消費パターン</text>

  <!-- Why not useState -->
  <rect x="80" y="185" width="240" height="80" rx="8" fill="#fef2f2" stroke="#ef4444" stroke-width="1.5"/>
  <text x="200" y="210" text-anchor="middle" font-size="11" font-weight="600" fill="#991b1b">useState を使わない理由</text>
  <text x="200" y="230" text-anchor="middle" font-size="10" fill="#475569">setState → 再レンダリング発生</text>
  <text x="200" y="248" text-anchor="middle" font-size="10" fill="#475569">プリフェッチ完了時に不要な描画更新</text>

  <!-- Why useRef -->
  <rect x="380" y="185" width="240" height="80" rx="8" fill="#f0fdf4" stroke="#22c55e" stroke-width="1.5"/>
  <text x="500" y="210" text-anchor="middle" font-size="11" font-weight="600" fill="#166534">useRef を使う理由</text>
  <text x="500" y="230" text-anchor="middle" font-size="10" fill="#475569">値の保持のみ → 再レンダリングなし</text>
  <text x="500" y="248" text-anchor="middle" font-size="10" fill="#475569">consume時だけ取り出せばOK</text>

  <text x="350" y="290" text-anchor="middle" font-size="11" fill="#94a3b8">「UIに影響しないキャッシュ」には useRef が最適</text>
</svg>
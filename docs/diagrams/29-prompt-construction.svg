<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 330" font-family="system-ui, sans-serif">
  <defs>
    <marker id="a29" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
  </defs>
  <rect width="700" height="330" rx="12" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
  <text x="350" y="28" text-anchor="middle" font-size="16" font-weight="700" fill="#0f172a">Battle Agent — プロンプト構築プロセス</text>

  <!-- Input: Game State -->
  <rect x="30" y="55" width="180" height="110" rx="8" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1.5"/>
  <text x="120" y="78" text-anchor="middle" font-size="11" font-weight="600" fill="#475569">入力: GameState</text>
  <line x1="40" y1="86" x2="200" y2="86" stroke="#e2e8f0" stroke-width="1"/>
  <text x="45" y="104" font-size="9" fill="#64748b">aiHp: 35</text>
  <text x="45" y="118" font-size="9" fill="#64748b">playerHp: 180</text>
  <text x="45" y="132" font-size="9" fill="#64748b">element: "ice"</text>
  <text x="45" y="146" font-size="9" fill="#64748b">name: "Glacius"</text>

  <!-- Arrow -->
  <line x1="215" y1="110" x2="255" y2="110" stroke="#64748b" stroke-width="1.5" marker-end="url(#a29)"/>

  <!-- buildSystemPrompt -->
  <rect x="260" y="50" width="200" height="120" rx="10" fill="#fef2f2" stroke="#ef4444" stroke-width="2"/>
  <text x="360" y="75" text-anchor="middle" font-size="11" font-weight="700" fill="#991b1b">buildSystemPrompt()</text>
  <line x1="270" y1="82" x2="450" y2="82" stroke="#fecaca" stroke-width="1"/>
  <text x="360" y="100" text-anchor="middle" font-size="9" fill="#475569">① キャラ人格を設定</text>
  <text x="360" y="116" text-anchor="middle" font-size="9" fill="#475569">② HP比率で感情を決定</text>
  <text x="360" y="132" text-anchor="middle" font-size="9" fill="#475569">③ 属性ヒントを追加</text>
  <text x="360" y="148" text-anchor="middle" font-size="9" fill="#ef4444">④ situationNote を注入</text>

  <!-- Arrow -->
  <line x1="465" y1="110" x2="495" y2="110" stroke="#64748b" stroke-width="1.5" marker-end="url(#a29)"/>

  <!-- Output: Prompt -->
  <rect x="500" y="50" width="180" height="120" rx="8" fill="#0f172a"/>
  <text x="590" y="72" text-anchor="middle" font-size="10" font-weight="600" fill="#22d3ee">生成されたプロンプト</text>
  <text x="510" y="92" font-size="8" fill="#94a3b8">あなたは怪獣</text>
  <text x="510" y="106" font-size="8" fill="#94a3b8">「グレイシアス」です。</text>
  <text x="510" y="120" font-size="8" fill="#94a3b8">属性: ice</text>
  <text x="510" y="134" font-size="8" fill="#fca5a5">状況: 追い詰められ</text>
  <text x="510" y="148" font-size="8" fill="#fca5a5">ている。焦りと怒り...</text>

  <!-- Decision tree -->
  <text x="350" y="200" text-anchor="middle" font-size="12" font-weight="600" fill="#0f172a">HP比率による感情決定ロジック</text>

  <rect x="40" y="215" width="150" height="35" rx="6" fill="#fef2f2" stroke="#ef4444" stroke-width="1.5"/>
  <text x="115" y="237" text-anchor="middle" font-size="9" fill="#991b1b">aiHp &lt; 25% → 絶体絶命</text>

  <rect x="200" y="215" width="150" height="35" rx="6" fill="#fffbeb" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="275" y="237" text-anchor="middle" font-size="9" fill="#92400e">aiHp &lt; 50% → 焦り</text>

  <rect x="360" y="215" width="170" height="35" rx="6" fill="#eff6ff" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="445" y="237" text-anchor="middle" font-size="9" fill="#1e40af">playerHp &lt; 25% → 余裕</text>

  <rect x="540" y="215" width="130" height="35" rx="6" fill="#f0fdf4" stroke="#22c55e" stroke-width="1.5"/>
  <text x="605" y="237" text-anchor="middle" font-size="9" fill="#166534">else → 互角</text>

  <!-- Config -->
  <rect x="150" y="270" width="400" height="40" rx="8" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1"/>
  <text x="350" y="290" text-anchor="middle" font-size="10" fill="#475569" font-family="monospace">temperature: 1.0 | maxOutputTokens: 150 | Structured Output</text>
  <text x="350" y="322" text-anchor="middle" font-size="10" fill="#94a3b8">動的プロンプト + 高temperature + JSON Schema = 「毎回違う感情的な攻撃」</text>
</svg>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 650 250" font-family="system-ui, sans-serif">
  <defs>
    <marker id="a41" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
    <marker id="a41r" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
    </marker>
  </defs>
  <rect width="650" height="250" rx="12" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
  <text x="325" y="28" text-anchor="middle" font-size="16" font-weight="700" fill="#0f172a">AbortController パターン — プリフェッチの安全な中断</text>

  <!-- Start -->
  <rect x="30" y="55" width="170" height="55" rx="8" fill="#f0fdf4" stroke="#22c55e" stroke-width="2"/>
  <text x="115" y="78" text-anchor="middle" font-size="10" font-weight="600" fill="#166534">prefetchAIAttack()</text>
  <text x="115" y="96" text-anchor="middle" font-size="9" fill="#64748b">new AbortController()</text>

  <line x1="205" y1="82" x2="250" y2="82" stroke="#64748b" stroke-width="1.5" marker-end="url(#a41)"/>

  <!-- Fetch -->
  <rect x="255" y="55" width="160" height="55" rx="8" fill="#eff6ff" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="335" y="78" text-anchor="middle" font-size="10" font-weight="600" fill="#1e40af">fetch(url, {</text>
  <text x="335" y="96" text-anchor="middle" font-size="10" fill="#64748b">signal: controller.signal })</text>

  <!-- Happy path -->
  <line x1="420" y1="70" x2="480" y2="70" stroke="#22c55e" stroke-width="1.5" marker-end="url(#a41)"/>
  <rect x="485" y="55" width="140" height="35" rx="6" fill="#f0fdf4" stroke="#22c55e" stroke-width="1.5"/>
  <text x="555" y="77" text-anchor="middle" font-size="10" fill="#166534">→ prefetchedRef</text>

  <!-- Abort path -->
  <line x1="420" y1="95" x2="480" y2="95" stroke="#ef4444" stroke-width="1.5" marker-end="url(#a41r)"/>
  <rect x="485" y="80" width="140" height="35" rx="6" fill="#fef2f2" stroke="#ef4444" stroke-width="1.5"/>
  <text x="555" y="102" text-anchor="middle" font-size="10" fill="#991b1b">catch → 無視</text>

  <!-- Abort trigger -->
  <rect x="30" y="140" width="280" height="70" rx="10" fill="#fef2f2" stroke="#ef4444" stroke-width="2"/>
  <text x="170" y="165" text-anchor="middle" font-size="11" font-weight="600" fill="#991b1b">中断タイミング</text>
  <text x="170" y="185" text-anchor="middle" font-size="9" fill="#475569">ゲーム終了時 / ページ遷移時 / 新しいプリフェッチ開始時</text>
  <text x="170" y="200" text-anchor="middle" font-size="9" fill="#ef4444" font-family="monospace">controller.abort()</text>

  <!-- Key insight -->
  <rect x="340" y="145" width="280" height="60" rx="8" fill="#0f172a"/>
  <text x="480" y="170" text-anchor="middle" font-size="10" fill="#22d3ee">fire-and-forget パターン</text>
  <text x="480" y="190" text-anchor="middle" font-size="9" fill="#94a3b8">成功 → キャッシュ / 失敗 → 無視</text>

  <text x="325" y="240" text-anchor="middle" font-size="10" fill="#94a3b8">プリフェッチは「あれば便利」— 失敗してもライブ生成にフォールバック</text>
</svg>
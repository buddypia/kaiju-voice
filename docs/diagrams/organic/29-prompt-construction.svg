<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 800" font-family="'Nunito', 'Quicksand', system-ui, sans-serif">
  <defs>
    <linearGradient id="bg29" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fdfbfb"/>
      <stop offset="100%" stop-color="#ebedee"/>
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="1400" height="800" fill="url(#bg29)"/>

  <!-- Title -->
  <text x="700" y="60" text-anchor="middle" font-size="46" font-weight="800" fill="#334155">プロンプト構築プロセス</text>
  <text x="700" y="95" text-anchor="middle" font-size="22" font-weight="600" fill="#64748b">Battle Agent — 動的プロンプト生成</text>

  <!-- Input: GameState -->
  <g transform="translate(200, 310)">
    <path d="M 50,-80 C 100,-90 120,-30 110,20 C 100,80 50,110 -20,100 C -90,90 -120,30 -100,-30 C -80,-80 -10,-70 50,-80 Z" fill="#fef08a" transform="scale(1.5)"/>
    <circle cx="-100" cy="-85" r="28" fill="#eab308"/>
    <text x="-100" y="-74" text-anchor="middle" font-size="32" font-weight="900" fill="#ffffff">1</text>
    <text x="0" y="-45" text-anchor="middle" font-size="22" font-weight="800" fill="#1e293b">GameState</text>
    <text x="0" y="-12" text-anchor="middle" font-size="15" font-weight="600" fill="#475569">aiHp: 35</text>
    <text x="0" y="12" text-anchor="middle" font-size="15" font-weight="600" fill="#475569">playerHp: 180</text>
    <text x="0" y="36" text-anchor="middle" font-size="15" font-weight="600" fill="#475569">element: "ice"</text>
    <text x="0" y="60" text-anchor="middle" font-size="15" font-weight="600" fill="#475569">name: "Glacius"</text>
  </g>

  <!-- Connector Input → Builder -->
  <path d="M 340,310 C 400,280 440,280 500,310" stroke="#94a3b8" stroke-width="4" stroke-dasharray="12 12" stroke-linecap="round" fill="none"/>

  <!-- buildSystemPrompt() -->
  <g transform="translate(680, 290)">
    <path d="M 90,-120 C 150,-100 160,-20 140,50 C 120,120 40,160 -40,140 C -120,120 -160,40 -130,-30 C -100,-100 -10,-140 90,-120 Z" fill="#fbcfe8" transform="scale(1.6, 1.4)"/>
    <circle cx="-130" cy="-100" r="30" fill="#ec4899"/>
    <text x="-130" y="-86" text-anchor="middle" font-size="32" font-weight="900" fill="#ffffff">2</text>
    <text x="0" y="-60" text-anchor="middle" font-size="20" font-weight="800" fill="#1e293b">buildSystemPrompt()</text>
    <text x="0" y="-25" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">1. キャラ人格を設定</text>
    <text x="0" y="2" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">2. HP比率で感情を決定</text>
    <text x="0" y="29" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">3. 属性ヒントを追加</text>
    <text x="0" y="56" text-anchor="middle" font-size="16" font-weight="600" fill="#ec4899">4. situationNote を注入</text>
  </g>

  <!-- Connector Builder → Output -->
  <path d="M 870,290 C 940,260 980,260 1040,290" stroke="#94a3b8" stroke-width="4" stroke-dasharray="12 12" stroke-linecap="round" fill="none"/>

  <!-- Output: Generated Prompt -->
  <g transform="translate(1190, 290)">
    <path d="M 80,-60 C 120,-30 110,40 70,80 C 30,120 -40,110 -80,70 C -120,30 -110,-40 -70,-80 C -30,-120 40,-90 80,-60 Z" fill="#8b5cf6" transform="scale(1.4)"/>
    <circle cx="-90" cy="-80" r="28" fill="#a855f7"/>
    <text x="-90" y="-66" text-anchor="middle" font-size="32" font-weight="900" fill="#ffffff">3</text>
    <text x="0" y="-40" text-anchor="middle" font-size="18" font-weight="800" fill="#ffffff">生成されたプロンプト</text>
    <text x="0" y="-10" text-anchor="middle" font-size="14" font-weight="600" fill="rgba(255,255,255,0.85)">あなたは怪獣</text>
    <text x="0" y="14" text-anchor="middle" font-size="14" font-weight="600" fill="rgba(255,255,255,0.85)">「グレイシアス」です</text>
    <text x="0" y="38" text-anchor="middle" font-size="14" font-weight="600" fill="rgba(255,255,255,0.85)">属性: ice</text>
    <text x="0" y="62" text-anchor="middle" font-size="14" font-weight="600" fill="#fca5a5">状況: 追い詰められている</text>
  </g>

  <!-- HP Decision Logic Section Title -->
  <text x="700" y="510" text-anchor="middle" font-size="28" font-weight="800" fill="#334155">HP比率による感情決定ロジック</text>

  <!-- Decision blobs -->
  <!-- Desperate -->
  <g transform="translate(200, 620)">
    <path d="M 60,-70 C 110,-60 120,0 90,50 C 60,100 -10,120 -60,90 C -110,60 -120,-10 -90,-60 C -60,-100 10,-80 60,-70 Z" fill="#fbcfe8" transform="scale(1.1)"/>
    <text x="0" y="-15" text-anchor="middle" font-size="16" font-weight="800" fill="#1e293b">aiHp &lt; 25%</text>
    <text x="0" y="15" text-anchor="middle" font-size="18" font-weight="800" fill="#ec4899">絶体絶命</text>
  </g>

  <!-- Anxious -->
  <g transform="translate(470, 620)">
    <path d="M 50,-80 C 100,-90 120,-30 110,20 C 100,80 50,110 -20,100 C -90,90 -120,30 -100,-30 C -80,-80 -10,-70 50,-80 Z" fill="#fed7aa" transform="scale(1.1)"/>
    <text x="0" y="-15" text-anchor="middle" font-size="16" font-weight="800" fill="#1e293b">aiHp &lt; 50%</text>
    <text x="0" y="15" text-anchor="middle" font-size="18" font-weight="800" fill="#f97316">焦り</text>
  </g>

  <!-- Confident -->
  <g transform="translate(740, 620)">
    <path d="M 30,-90 C 90,-80 110,-20 100,40 C 90,100 20,110 -40,90 C -100,70 -110,10 -80,-40 C -50,-90 -20,-100 30,-90 Z" fill="#bfdbfe" transform="scale(1.1)"/>
    <text x="0" y="-20" text-anchor="middle" font-size="16" font-weight="800" fill="#1e293b">playerHp &lt; 25%</text>
    <text x="0" y="10" text-anchor="middle" font-size="18" font-weight="800" fill="#3b82f6">余裕</text>
  </g>

  <!-- Equal -->
  <g transform="translate(1010, 620)">
    <path d="M 80,-60 C 120,-30 110,40 70,80 C 30,120 -40,110 -80,70 C -120,30 -110,-40 -70,-80 C -30,-120 40,-90 80,-60 Z" fill="#bbf7d0" transform="scale(1.1)"/>
    <text x="0" y="-10" text-anchor="middle" font-size="16" font-weight="800" fill="#1e293b">else</text>
    <text x="0" y="20" text-anchor="middle" font-size="18" font-weight="800" fill="#22c55e">互角</text>
  </g>

  <!-- Config pill -->
  <g transform="translate(1240, 620)">
    <path d="M 40,-85 C 95,-75 115,-15 105,35 C 95,85 35,115 -25,95 C -85,75 -115,15 -95,-45 C -75,-85 -15,-95 40,-85 Z" fill="#e9d5ff" transform="scale(1.1)"/>
    <text x="0" y="-20" text-anchor="middle" font-size="14" font-weight="800" fill="#1e293b">temperature: 1.0</text>
    <text x="0" y="5" text-anchor="middle" font-size="14" font-weight="800" fill="#1e293b">maxTokens: 150</text>
    <text x="0" y="30" text-anchor="middle" font-size="14" font-weight="600" fill="#a855f7">Structured Output</text>
  </g>

  <!-- Footer -->
  <rect x="260" y="755" width="880" height="36" rx="30" fill="white"/>
  <text x="700" y="779" text-anchor="middle" font-size="16" font-weight="600" fill="#64748b">動的プロンプト + 高temperature + JSON Schema = 「毎回違う感情的な攻撃」</text>
</svg>
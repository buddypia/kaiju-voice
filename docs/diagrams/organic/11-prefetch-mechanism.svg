<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 800" font-family="'Nunito', 'Quicksand', system-ui, sans-serif">
  <defs>
    <linearGradient id="bg11" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fdfbfb"/>
      <stop offset="100%" stop-color="#ebedee"/>
    </linearGradient>
    <path id="blob-c1-11" d="M 50,-80 C 100,-90 120,-30 110,20 C 100,80 50,110 -20,100 C -90,90 -120,30 -100,-30 C -80,-80 -10,-70 50,-80 Z"/>
    <path id="blob-c2-11" d="M 60,-70 C 110,-60 120,0 90,50 C 60,100 -10,120 -60,90 C -110,60 -120,-10 -90,-60 C -60,-100 10,-80 60,-70 Z"/>
    <path id="blob-c3-11" d="M 30,-90 C 90,-80 110,-20 100,40 C 90,100 20,110 -40,90 C -100,70 -110,10 -80,-40 C -50,-90 -20,-100 30,-90 Z"/>
    <path id="blob-c4-11" d="M 80,-60 C 120,-30 110,40 70,80 C 30,120 -40,110 -80,70 C -120,30 -110,-40 -70,-80 C -30,-120 40,-90 80,-60 Z"/>
    <path id="blob-hub-11" d="M 90,-120 C 150,-100 160,-20 140,50 C 120,120 40,160 -40,140 C -120,120 -160,40 -130,-30 C -100,-100 -10,-140 90,-120 Z"/>
  </defs>

  <!-- Background -->
  <rect width="1400" height="800" fill="url(#bg11)"/>

  <!-- Title -->
  <text x="700" y="65" text-anchor="middle" font-size="46" font-weight="800" fill="#334155">プリフェッチ -- useRef キャッシュパターン</text>
  <text x="700" y="100" text-anchor="middle" font-size="22" font-weight="600" fill="#64748b">UIに影響しないキャッシュには useRef が最適</text>

  <!-- Blob 1: prefetchAIAttack -->
  <g transform="translate(280, 310)">
    <use href="#blob-c1-11" transform="scale(1.6)" fill="#bfdbfe"/>
    <use href="#blob-c1-11" transform="scale(1.4)" fill="#bfdbfe"/>
    <circle cx="-90" cy="-90" r="32" fill="#3b82f6"/>
    <text x="-90" y="-78" text-anchor="middle" font-size="42" font-weight="900" fill="#ffffff">1</text>
    <text x="0" y="-30" text-anchor="middle" font-size="24" font-weight="800" fill="#1e293b">prefetchAIAttack()</text>
    <text x="0" y="5" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">録音開始と同時に</text>
    <text x="0" y="30" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">fetch('/api/ai-opponent')</text>
    <text x="0" y="60" text-anchor="middle" font-size="16" font-weight="600" fill="#3b82f6">+ AbortController</text>
  </g>

  <!-- Blob 2: useRef (Hub) -->
  <g transform="translate(700, 310)">
    <use href="#blob-hub-11" transform="scale(1.1)" fill="#e9d5ff"/>
    <use href="#blob-hub-11" transform="scale(0.9)" fill="#e9d5ff"/>
    <circle cx="0" cy="-100" r="32" fill="#8b5cf6"/>
    <text x="0" y="-88" text-anchor="middle" font-size="42" font-weight="900" fill="#ffffff">2</text>
    <text x="0" y="-20" text-anchor="middle" font-size="32" font-weight="800" fill="#1e293b">useRef</text>
    <text x="0" y="20" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">prefetchedRef</text>
    <text x="0" y="50" text-anchor="middle" font-size="16" font-weight="600" fill="#64748b">再レンダリングなし</text>
  </g>

  <!-- Blob 3: consumePrefetched -->
  <g transform="translate(1120, 310)">
    <use href="#blob-c3-11" transform="scale(1.6)" fill="#bbf7d0"/>
    <use href="#blob-c3-11" transform="scale(1.4)" fill="#bbf7d0"/>
    <circle cx="-90" cy="-100" r="32" fill="#22c55e"/>
    <text x="-90" y="-88" text-anchor="middle" font-size="42" font-weight="900" fill="#ffffff">3</text>
    <text x="0" y="-30" text-anchor="middle" font-size="24" font-weight="800" fill="#1e293b">consumePrefetched()</text>
    <text x="0" y="5" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">AIターン時に呼び出し</text>
    <text x="0" y="30" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">結果を取得 + ref を null化</text>
    <text x="0" y="60" text-anchor="middle" font-size="16" font-weight="600" fill="#22c55e">1回限りの消費パターン</text>
  </g>

  <!-- Connector: 1 → 2 -->
  <path d="M 440,300 C 500,280 560,280 610,300" stroke="#94a3b8" stroke-width="4" stroke-dasharray="12 12" stroke-linecap="round" fill="none"/>
  <text x="525" y="275" text-anchor="middle" font-size="16" font-weight="600" fill="#64748b">保存</text>

  <!-- Connector: 2 → 3 -->
  <path d="M 800,300 C 860,280 960,280 1020,300" stroke="#94a3b8" stroke-width="4" stroke-dasharray="12 12" stroke-linecap="round" fill="none"/>
  <text x="910" y="275" text-anchor="middle" font-size="16" font-weight="600" fill="#64748b">取得</text>

  <!-- Blob 4: useState NG -->
  <g transform="translate(420, 630)">
    <use href="#blob-c4-11" transform="scale(1.5)" fill="#fed7aa"/>
    <use href="#blob-c4-11" transform="scale(1.3)" fill="#fed7aa"/>
    <text x="0" y="-25" text-anchor="middle" font-size="24" font-weight="800" fill="#1e293b">useState を使わない理由</text>
    <text x="0" y="10" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">setState で再レンダリング発生</text>
    <text x="0" y="38" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">プリフェッチ完了時に不要な描画更新</text>
  </g>

  <!-- Blob 5: useRef OK -->
  <g transform="translate(980, 630)">
    <use href="#blob-c2-11" transform="scale(1.5)" fill="#bbf7d0"/>
    <use href="#blob-c2-11" transform="scale(1.3)" fill="#bbf7d0"/>
    <text x="0" y="-25" text-anchor="middle" font-size="24" font-weight="800" fill="#1e293b">useRef を使う理由</text>
    <text x="0" y="10" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">値の保持のみ で再レンダリングなし</text>
    <text x="0" y="38" text-anchor="middle" font-size="16" font-weight="600" fill="#475569">consume時だけ取り出せばOK</text>
  </g>

  <!-- Footer -->
  <rect x="430" y="755" width="540" height="36" rx="30" fill="#ffffff" opacity="0.9"/>
  <text x="700" y="779" text-anchor="middle" font-size="16" font-weight="600" fill="#64748b">「UIに影響しないキャッシュ」には useRef が最適</text>
</svg>
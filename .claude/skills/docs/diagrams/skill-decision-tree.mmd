%% スキル選択意思決定ツリー
%% 作業タイプに応じてどのスキルを使用すべきか案内

flowchart TD
    Start([作業開始])

    %% 1次分岐: 作業タイプ
    Q1{作業タイプは?}

    %% 開発関連
    subgraph Dev["開発作業"]
        Q2{開発詳細タイプ?}

        NewFeature[新機能開発]
        ModifyFeature[既存機能修正]
        BugFix[バグ修正]

        FP1[feature-pilot]
        FP2[feature-pilot<br/>MODIFY_FEATURE]
        BF1[bug-fix]

        Q2 -->|新機能| NewFeature --> FP1
        Q2 -->|機能修正| ModifyFeature --> FP2
        Q2 -->|バグ| BugFix --> BF1
    end

    %% 品質関連
    subgraph QA["品質検証"]
        Q3{検証タイプ?}

        BuildTest[ビルド/解析/テスト]
        Security[セキュリティ検査]
        CodeScan[コードスキャン]

        FQA1[pre-quality-gate]
        SS1[security-scan]
        HS1[hardcoded-scan]

        Q3 -->|ビルド/テスト| BuildTest --> FQA1
        Q3 -->|セキュリティ| Security --> SS1
        Q3 -->|ハードコーディング| CodeScan --> HS1
    end

    %% ドキュメント関連
    subgraph Docs["ドキュメント作業"]
        Q4{ドキュメントタイプ?}

        Glossary[用語集]
        Claude[CLAUDE.md]
        Wireframe[ワイヤーフレーム]
        Spec[SPEC 修正]

        GU1[glossary-updater]
        SCM1[sync-claude-md]
        WM1[wireframe-manager]
        FSU1[feature-spec-updater]

        Q4 -->|用語集| Glossary --> GU1
        Q4 -->|CLAUDE.md| Claude --> SCM1
        Q4 -->|ワイヤーフレーム| Wireframe --> WM1
        Q4 -->|SPEC| Spec --> FSU1
    end

    %% バックエンド関連
    subgraph Backend["バックエンド作業"]
        Q5{バックエンドタイプ?}

        Schema[スキーマ同期]
        Migration[マイグレーション]
        EdgeFunc[Edge Function]

        SUS1[supabase-sync]
        MS1[migration-sync]
        EFV1[edge-function-validator]

        Q5 -->|スキーマ| Schema --> SUS1
        Q5 -->|マイグレーション| Migration --> MS1
        Q5 -->|Edge Func| EdgeFunc --> EFV1
    end

    %% 多言語関連
    subgraph I18n["多言語作業"]
        ARB[ARB 同期]
        AS1[arb-sync]
        ARB --> AS1
    end

    %% リサーチ関連
    subgraph Research["リサーチ作業"]
        Q6{リサーチタイプ?}

        Market[市場分析]
        Deep[深層リサーチ]
        Gap[リサーチギャップ]

        MIS1[market-intelligence-scanner]
        GDR1[google-deep-research]
        RGA1[research-gap-analyzer]

        Q6 -->|市場分析| Market --> MIS1
        Q6 -->|深層リサーチ| Deep --> GDR1
        Q6 -->|リサーチギャップ| Gap --> RGA1
    end

    %% 実行モード
    subgraph Mode["実行モード"]
        Q7{実行モード?}

        Fast[高速実行]
        Persist[完了まで]

        TM1[turbo-mode]
        PM1[persistent-mode]

        Q7 -->|高速| Fast --> TM1
        Q7 -->|完了まで| Persist --> PM1
    end

    %% 復旧/診断
    subgraph Recovery["復旧/診断"]
        Doctor[CONTEXT 復旧]
        Health[スキルヘルスチェック]

        FD1[feature-doctor]
        SHC1[skill-health-check]

        Doctor --> FD1
        Health --> SHC1
    end

    %% 接続
    Start --> Q1

    Q1 -->|開発| Q2
    Q1 -->|品質検証| Q3
    Q1 -->|ドキュメント| Q4
    Q1 -->|バックエンド| Q5
    Q1 -->|多言語| ARB
    Q1 -->|リサーチ| Q6
    Q1 -->|実行モード| Q7
    Q1 -->|復旧/診断| Recovery

    %% スタイル
    classDef question fill:#fff3e0,stroke:#e65100
    classDef skill fill:#e3f2fd,stroke:#1565c0
    classDef category fill:#f5f5f5,stroke:#9e9e9e
    classDef start fill:#c8e6c9,stroke:#2e7d32

    class Q1,Q2,Q3,Q4,Q5,Q6,Q7 question
    class FP1,FP2,BF1,FQA1,SS1,HS1,GU1,SCM1,WM1,FSU1,SUS1,MS1,EFV1,AS1,MIS1,GDR1,RGA1,TM1,PM1,FD1,SHC1 skill
    class Start start

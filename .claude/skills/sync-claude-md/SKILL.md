---
name: sync-claude-md
description: プロジェクト プロジェクトの CLAUDE.md 文書をプロジェクト変更事項と同期するスキル。新しいライブラリ追加、API Route 変更後に CLAUDE.md 更新が必要か確認して案内する。「CLAUDE.md 更新」、「文書同期」、「プロジェクト指針更新」等のリクエストでトリガーされる。
doc_contract:
  review_interval_days: 90
---

# CLAUDE.md Updater

## Overview

プロジェクト プロジェクトの `CLAUDE.md` は AI コーディングアシスタントの唯一の Source of Truth である。このスキルはプロジェクト変更事項が発生した時に CLAUDE.md を同期し、最新状態を維持する方法を案内する。

## トリガー条件

次の状況でこのスキル使用を提案する:

1. **ライブラリ追加/更新**: `package.json` 変更後
2. **API Route 追加/修正**: `src/app/api/` 変更後
3. **アーキテクチャ変更**: 新しいパターンや規則導入時
4. **明示的リクエスト**: 「CLAUDE.md 更新」、「文書同期」

## CLAUDE.md 構造

| セクション                   | 内容                         | 更新トリガー                 |
| ---------------------------- | ---------------------------- | ---------------------------- |
| **プロジェクト識別情報**     | フレームワーク、サポート言語 | フレームワーク変更、言語追加 |
| **主要ライブラリバージョン** | 核心パッケージバージョン     | package.json 変更            |
| **遵守事項**                 | MUST/SHOULD/MUST NOT 規則    | コーディング規則変更         |
| **アーキテクチャ概要**       | Feature-First ダイアグラム   | アーキテクチャ変更           |
| **プロジェクト構造**         | フォルダ構造                 | 新フォルダ追加               |
| **API Routes**               | API Routes 一覧              | API 変更                     |
| **言語設定**                 | プロジェクト言語設定         | 言語設定変更                 |
| **ビジネスコンテキスト**     | 目標、戦略                   | 戦略変更                     |
| **特殊設定**                 | 環境変数                     | 設定変更                     |

## ワークフロー

### 1. 変更事項検出

```
# ライブラリ変更検出
Read package.json (dependencies / devDependencies セクション)

# API Route 変更検出
Glob src/app/api/*/route.ts
```

### 2. CLAUDE.md 現在状態確認

```
Read CLAUDE.md

# 主要セクション確認
- ライブラリバージョンテーブル
- API Routes リスト
- 環境変数テーブル
```

### 3. 不一致項目識別

```
## CLAUDE.md 同期必要項目

### ライブラリバージョン
| パッケージ | CLAUDE.md | package.json | 措置 |
|--------|-----------|--------------|------|
| @google/genai | 1.0.0 | 1.0.0 | ✅ 一致 |
| next | 16.0.0 | 16.1.0 | ❌ 更新必要 |

### API Routes
| ルート | CLAUDE.md | 実際ファイル | 措置 |
|--------|-----------|-----------|------|
| /api/battle/start | ✅ | ✅ | 一致 |
| /api/battle/result | ❌ | ✅ | 追加必要 |
```

### 4. 更新実行

各セクション別更新方法:

#### A. ライブラリバージョン更新

```markdown
### 主要ライブラリバージョン

| カテゴリー         | ライブラリ     | バージョン |
| ------------------ | -------------- | ---------- | ------ |
| **AI**             | @google/genai  | 1.0.0      |
| **AI SDK**         | @ai-sdk/google | 1.0.0      |
| **フレームワーク** | next           | 16.1.0     | ← 更新 |
```

#### B. API Routes リスト更新

```markdown
### API Routes

| ルート               | 用途         |
| -------------------- | ------------ | ------ |
| `/api/battle/start`  | AI対戦開始   |
| `/api/battle/result` | 対戦結果取得 | ← 追加 |
```

### 5. 結果報告

```
## CLAUDE.md 同期結果

### 更新された項目
✅ next バージョン: 16.0.0 → 16.1.0
✅ API Route 追加: /api/battle/result

### 確認必要項目
⚠️ 環境変数セクション検討必要

### 未変更項目
- プロジェクト識別情報
- 遵守事項
- アーキテクチャ概要
```

## セクション別更新規則

### 主要ライブラリバージョン (核心のみ)

次のパッケージのみ CLAUDE.md に記録:

```
@google/genai, @ai-sdk/google, next, react,
tailwindcss, zod, typescript
```

その他パッケージは `package.json` 参照で代替。

### API Routes

全ての API Route をテーブルに含むが、必須環境変数情報も一緒に記録:

```markdown
| ルート              | 用途       | 必須環境変数     |
| ------------------- | ---------- | ---------------- |
| `/api/battle/start` | AI対戦開始 | `GEMINI_API_KEY` |
```

### 遵守事項変更

新規則追加時次の様式使用:

```markdown
### 必須規則 (MUST)

N. **規則名**: 説明
```

## 自動化検査項目

| 検査                 | 方法                           | 不一致時        |
| -------------------- | ------------------------------ | --------------- |
| ライブラリバージョン | package.json vs CLAUDE.md 比較 | バージョン更新  |
| API Routes           | src/app/api/ vs CLAUDE.md 比較 | ルート追加/削除 |
| 言語設定             | CLAUDE.md 確認                 | 言語設定更新    |
| Node.js バージョン   | package.json vs CLAUDE.md 比較 | バージョン更新  |

## 注意事項

- **一貫性維持**: テーブル形式、絵文字使用等既存スタイル維持
- **最小変更**: 変更された項目のみ更新、不要なフォーマット変更禁止
- **リンク検証**: 文書リンク追加/変更時有効性確認
- **目次同期化**: セクション追加/削除時目次も更新

## Resources

### references/

- `section-templates.md`: CLAUDE.md セクション別作成テンプレート

このスキルは別途実行スクリプトが必要ない。ファイル比較と編集ツールで同期化を実行する。
